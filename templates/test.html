{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static "/styles/base.css" %}" type="text/css">
    <link rel="stylesheet" href="{% static "/styles/test.css" %}" type="text/css">
    <link rel="stylesheet" href="{% static "/styles/nav.css" %}" type="text/css">
    <title>MemoryProject</title>
</head>
    <body>
    <main>
        <div class="test">
            {% include 'nav.html' %}
            <div class="nav-test">
                <button class="previous is-valid" id="btn-previous" onclick="PreviousTask()"></button>
                <ul>
                    <li><span class="exercises">Задание <span class="curr-task" id="curr-task">1</span>/{{ test.count }}</span></li>
                    <li><a href="#" class="section selected">Память</a></li>
                    <li><a href="#" class="section">Мышление</a></li>
                    <li><a href="#" class="section">Внимание</a></li>
                    <li><a href="#" class="exit">Завершить тест</a></li>
                </ul>
                <button class="next is-valid" id="btn-next" onclick="NextTask()"></button>
            </div>
            {% for task in test %}
            <div id="{{ task.task.number }}" class="block-hidden">
                <div class="description">
                    <img alt="exercise" src="{{ task.task.url }}" />
                </div>
                <div class="rating">
                    <div class="note">
                        <h3>Оцените выполнения задания</h3>
                        <p>{{ task.task.mark }}</p>
                    </div>
                    <div class="mark">
                        <p class="incorrect-label">Не справился</p>
                        <div class="incorrect">
                            <input type="radio" id="1-answer" name="answer{{ task.task.number }}" class="radio incorrect"/>
                            <label for="1-answer">{{ task.task.mark_incorrect }}</label>
                        </div>
                        <div class="neutral">
                            <input type="radio" id="2-answer" name="answer{{ task.task.number }}" class="radio neutral"/>
                            <label for="2-answer">{{ task.task.mark_neutral }}</label>
                        </div>
                        <div class="correct">
                            <input type="radio" id="3-answer" name="answer{{ task.task.number }}" class="radio correct"/>
                            <label for="3-answer">{{ task.task.mark_correct }}</label>
                        </div>
                        <p class="correct-label">Справился</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </main>
    <script>
        let count = 1;
        const taskNumber = document.getElementById('curr-task');
        const previousButton = document.getElementById('btn-previous');
        const nextButton = document.getElementById('btn-next');
        const maxLength = {{ test.count }};

        ShowBlock(count);
        CheckButtons();

        function HideBlock(number){
            const taskBlock = document.getElementById(number.toString());
            taskBlock.setAttribute('class', 'block-hidden');
        }

        function ShowBlock(number){
            const newBlock = document.getElementById(number);
            newBlock.removeAttribute('class');
        }

        function CheckButtons(){
            if (count === maxLength){
                nextButton.setAttribute('disabled', '');
                nextButton.classList.add('is-invalid');
            }
            else{
                nextButton.removeAttribute('disabled');
                nextButton.classList.remove('is-invalid');
            }

            if (count === 1){
                previousButton.setAttribute('disabled', '');
                previousButton.classList.add('is-invalid');
            }
            else{
                previousButton.removeAttribute('disabled');
                previousButton.classList.remove('is-invalid');
            }
        }

        function NextTask(){
            HideBlock(count);
            count += 1;
            ShowBlock(count);
            taskNumber.textContent = count;
            CheckButtons();
        }

        function PreviousTask(){
            HideBlock(count);
            count -= 1;
            ShowBlock(count);
            taskNumber.textContent = count;
            CheckButtons();
        }
    </script>
    </body>
</html>